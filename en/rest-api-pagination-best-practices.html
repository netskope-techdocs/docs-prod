<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="yes"></meta><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
					var anchoroption = true;
				
			
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>REST API Pagination Best Practices</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/roboto.font.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/rwd-table.min.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/layout-custom-style.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="js/toc.js" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/rwd-table.min.js" type="text/javascript"></script><script src="../js/responsive-tables.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="../js/lunr.js" type="text/javascript"></script><script src="../js/jquery.mark.min.js" type="text/javascript"></script><script src="js/data.js" type="text/javascript"></script><script src="../js/search.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta name="generator" content="Paligo"></meta><link rel="prev" href="rest-api-events-and-alerts-response-descriptions.html" title="REST API Events and Alerts Response Descriptions"></link><link rel="next" href="get-client-data.html" title="Get Client Data"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script type="text/javascript">var propertyid = '256425220';

						(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
						(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
						m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
						})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
						
						ga('create', propertyid, 'auto');
						ga('send', 'pageview');
					</script><script type="text/javascript">
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				if (!document.documentMode) {
				$('.materialboxed').materialbox();
				}});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><h1 class="publication-title">Netskope Help</h1><div class="toolbar"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"></div><div class="tool-print print-icon"><a onclick="window.print();return false;"><i class="fa fa-print" aria-hidden="true"><span class="print-text">print</span></i></a></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"> <a href="index-en.html">Netskope Help</a></li><li class="breadcrumb-link"><a href="admin-console.html">Admin Console</a></li><li class="breadcrumb-link"><a href="skopeit.html">SkopeIT</a></li><li class="breadcrumb-link"><a href="netskope-rest-apis.html">Netskope REST APIs</a></li><li class="breadcrumb-link"><a href="netskope-platform-api-endpoints.html">Netskope Platform API Endpoints</a></li><li class="breadcrumb-node">REST API Pagination Best Practices</li></ul></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="rest-api-events-and-alerts-response-descriptions.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="get-client-data.html">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-7f13f416-bf9e-64c7-b158-aa0a6cbc2ed4" data-permalink="rest-api-pagination-best-practices.html" data-topic-level="1" data-relative-prefix="" data-time-modified="May 14, 2020" data-publication-date="" id="UUID-78524b74-59e5-14a1-0323-cc3e76812774"><div class="titlepage"><div><div class="title"><h6 class="title">REST API Pagination Best Practices</h6></div></div></div><p>This topic provides best practices for the REST API calls that return large volumes of data. These best practices have been developed to ensure that your queries return the entire data set by using pagination.</p><h7 id="idm45941602683104" class="bridgehead">Endpoints that support Pagination</h7><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Alerts: <code class="literal">https://<span class="emphasis"><em>&lt;Netskope Tenant URL&gt;</em></span>/api/v1/alerts</code></p></li><li class="listitem"><p>Events: <code class="literal">https://<span class="emphasis"><em>&lt;Netskope Tenant URL&gt;</em></span>/api/v1/events</code></p></li></ul></div><h7 id="idm45941602679264" class="bridgehead">Additional query parameters required for this process</h7><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">starttime</code>: This parameter restricts events to those that have timestamps greater than this value, which is Unix epoch time.</p></li><li class="listitem"><p><code class="literal">endtime</code>: This parameter restricts events to those that have timestamps less than or equal to this value, which is Unix epoch time.</p></li><li class="listitem"><p><code class="literal">limit</code>: This parameter is used to define the page size of your query. Whenever possible, using the max page size that Netskope supports (5000 records per page) is recommended.</p></li><li class="listitem"><p><code class="literal">skip</code>: This parameter is the primary method to move to the next page. Combining the use of <code class="literal">skip</code> with <code class="literal">limit</code> is the recommended pagination approach.</p></li></ul></div><h7 id="idm45941602674976" class="bridgehead">Primary Index</h7><p>Netskope does not have a primary index field for records returned in the above API endpoints.</p><h7 id="idm45941602674352" class="bridgehead">Timestamp</h7><p>Every record returned by the above endpoints has an attribute referenced as <code class="literal">timestamp</code>. This attribute value is used as the index for the <code class="literal">starttime</code> and <code class="literal">endtime</code> parameters mentioned above. The precision of this attribute in epoch time is that of full seconds, not microseconds. This results in the value of the attribute often being shared in numerous records.</p><h7 id="UUID-78524b74-59e5-14a1-0323-cc3e76812774_bridgehead-idm23178661244256" class="bridgehead">Netskope Log Record Processing</h7><p>Netskope log record processing is built upon many micro services that make up the larger Netskope platform, so each micro service generates their respective events and populates a single data store for the REST API to consume. This may cause a delay from the time of event for records that are available to query via the API.</p><h7 id="idm45941602671680" class="bridgehead">Query Offset</h7><p>To work within the controls of timestamp precision, and log processing work flows within Netskope’s Security Platform, the use of a Query Offset parameter in the workflow is recommended. This value will be used to decrement the <code class="literal">endtime</code> parameter to ensure that the request of records captures all of the records for that requested timestamp attribute. Setting this value at 5 minutes (300 seconds) is recommended.</p><h7 id="idm45941602670288" class="bridgehead">Timeperiod</h7><p>Netskope supports passing the <code class="literal">timeperiod</code> query attribute in place of the <code class="literal">starttime</code> and <code class="literal">endtime</code> parameters. Using this approach allows you to define the period in question and issue a query. The <code class="literal">timeperiod</code> values assume the period from the time of query (epoch time of query). In order to properly paginate, you need to issue subsequent queries. As you are unable to define a specific epoch value in this approach, your subsequent queries will have a different <code class="literal">starttime</code> as the first query. The end result is a higher probability of missing records. </p><p>Using this concept in the pagination process is recommended, but use this parameter and decrement your <code class="literal">endtime</code> by this value to define your <code class="literal">starttime</code> parameter:</p><p><code class="literal">[starttime = (endtime - timeperiod)]</code></p><h7 id="idm45941602664720" class="bridgehead">Quota</h7><p>Netskope currently restricts REST API queries per tenant. These limits are 4 requests per second, with a max queue depth of 20. If more requests arrive after queue saturation, Netskope will respond with a 429 message.</p><h7 id="idm45941602663968" class="bridgehead">Headers</h7><p>Netskope requests that any scripts that interface with the REST API also populate the User-Agent header field. This value is useful when troubleshooting to track which application is leveraging the REST API functionality. Naming your script, and ideally appending the tenant value to this as well, is recommended:</p><p><code class="literal">User-Agent = simple_api_script-<span class="emphasis"><em>&lt;tenant&gt;</em></span></code></p><h7 id="idm45941602662720" class="bridgehead">Sample Pagination Workflow</h7><p><span class="strong strong"><strong>Single Pass (not reoccurring poll) Pseudo-Code example</strong></span></p><pre class="programlisting"># variable definition
TENANT = &lt;Netskope Tenant ID&gt;
TOKEN = &lt;Netskope Tenant API Token&gt;

TIME = current epoch timestamp
QUERY_OFFSET = 300
TIMEPERIOD = 86400 (24 hours)
PAGE = 5000

########## 
calculated variable adjustments
ENDTIME = TIME - QUERY_OFFSET
STARTTIME = ENDTIME - TIMPERIOD

########## 
first queryURL = get https://tenant/endpoint?starttime=STARTTIME&amp;endtime=ENDTIME&amp;limit=PAGE

PAGE = REST API GET URL

# check if we have more records and require pagination SKIP = PAGE while length of page = PAGE
   PAGE = get URL + &amp;skip=SKIP
   SKIP = SKIP + PAGE
else
   end pagination</pre><p><span class="strong strong"><strong>Python Example Script</strong></span></p><p>This sample can be provided on GitHub by request.</p><pre class="programlisting">#! /usr/bin/env python 

################################################################################

## Netskope SAMPLE Pagination Script!!
## This is not intended to be used for production.
## This script attempts to demonstrate pagination
## Its intention is to avoid missed records and work within Netskope API Quota
################################################################################
## Author: J A (ja@netskope.com) 4/30/2020
################################################################################ 
import requests
import time
import math  

TENANT = "xxxxxxxxxxxx.goskope.com" ### Netskope Tenant
API_TOKEN = "xxxxxxxxxxxxxxxxxxxxxxx" ### Tenant API_TOKEN
RANGE = 86400 ### Values supported: 3600|86400|604800|2592000|5184000|7776000 = 1 Hour| 24 Hours | 7 Days | 30 Days | 60 Days | 90 Days
QUERY_OFFSET = 300 ### Due to how Netskope process logs, we go back in time 5 minutes
PAGE = 5000 ### Netskope's MAX page size is 5000 records per page
SCRIPT_NAME = 'netskpe_api_test' 

##############################
 '''
Set your time variables - we first capture the time of execution to ensure that all pages query the same data set'''time_of_execute = math.trunc(time.time()) 

'''
Due to the way that Netskope stores data, there is slight delay between record creation and delivery to REST API data store, in order to avoid loss of records, we will start our query 5 minutes older than current time see QUERY_OFFSET variable definition above.
'''
time_offset = time_of_execute - QUERY_OFFSET 
'''
In order to ensure we do not miss records, we are going to use start and end times in our query string. We will define the range by decrementing our starttime by the range defined above.
'''
starttime = time_offset - RANGE 
endtime = time_offset 
'''
Setting the variables we are going to pass the functions below.
'''
values = {'starttime' : starttime, "endtime" : endtime, "page" : PAGE, 'token' : API_TOKEN, 'skip': 0} 
'''
Function that defines our QUERY URL, we are checking if SKIP has been populated and modify QUERY appropriately to SKIP our records for our paginationThis example uses the /api/v1/alerts endpoint, /api/v1/events endpoint operates in the same manner.
'''
def _url(values):
    path = 'https://' + TENANT + '/api/v1/alerts?starttime=' + str(values['starttime']) + '&amp;endtime=' + str(values['endtime']) + '&amp;limit=' + str(values['page']) + "&amp;token=" + str(values['token'])
    if values['skip'] != 0:
        path = path + '&amp;skip=' + str(values['skip'])
        return path
    else:
        return path  
'''
Function to call Netskope, we are consuming our _url helper function to the the correct query string. If status code returned is 429, that means the quota has been exceeded for this tenant, we are sleeping 5 seconds in this example to allow for queue drain. 
Quota is 4 requests per second, with max queue depth of 20.
NOTE: user-agent is optional: we do recommend defining a User-Agent to assist in troubleshooting in the future. Netskope can trace work flows based on this value.
'''
def get_logs():
    r = requests.get(_url(values),headers={'User-Agent' : SCRIPT_NAME })
    if r.status_code !=200:
        print('You are unable to connect to Netskope with data provided.'+ r.status_code)
        raise api error()
    elif r.status_code == 429:
        print('You have overrun the api quota, sleeping 5 seconds')        time.sleep(5)
    else:
        return r.json() 
'''
The main loop for collecting records. We validate the number of records returned and compare this to our PAGE size defined. If the number of records matches thePAGE  we increment the SKIP attribute by PAGE and issue another query.
'''
count = 0
while count == 0:
    data_length = len(get_logs()['data'])
    if data_length == PAGE:
        values['skip'] = values['skip'] + PAGE
        print('We have just collected ' + str(PAGE) + ' records. Total 
records collected: ' + str(values['skip']))
    else:
        count = 1
else:
    print('We have now collected '+ str(data_length+values['skip']) + ' records over ' + str(values['skip']/PAGE+1) + ' pages') 
'''
End of Example:
Additional Notes:
This is a single pass example that uses time of execution for all its dates. If you intend this to be a service to continue on an interval, it is recommended that you write a checkpoint file of the start and end time to disk. On subsequent executions read checkpoint and update your start and end times appropriately.
'''</pre></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article><div class="feedback-panel"><div id="email-feedback" class="no-voting toggle-feedback"><p><a href="mailto:techpubs@netskope.com?subject=Feedback%20for%20help%20topic%20%22REST%20API%20Pagination%20Best%20Practices%22&amp;body=%0A%09%09%09%09%0A%09%09%09%09%0A%09%09%09%09_______________________%0A%09%09%09%09%0A%09%09%09Please%20add%20your%20feedback%20above%20for%20topic%20%22REST%20API%20Pagination%20Best%20Practices%22%20in%20the%20publication%20%22Netskope%20Help%22."><i aria-hidden="true" class="fa fa-pencil-square-o feedbackicon"></i>Would you like to provide feedback? Just click here to suggest edits.</a></p></div></div></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="rest-api-events-and-alerts-response-descriptions.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="get-client-data.html">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2021 Netskope </div><div class="date-modified"><span class="date-modified-text">Last modified: </span><span class="formatted-date">May 14, 2020</span></div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div></body></html>
