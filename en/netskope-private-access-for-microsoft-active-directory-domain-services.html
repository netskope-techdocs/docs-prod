<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="yes"></meta><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
					var anchoroption = true;
				
			
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Netskope Private Access for Microsoft Active Directory Domain Services</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/roboto.font.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/rwd-table.min.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/layout-custom-style.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="js/toc.js" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/rwd-table.min.js" type="text/javascript"></script><script src="../js/responsive-tables.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="../js/lunr.js" type="text/javascript"></script><script src="../js/jquery.mark.min.js" type="text/javascript"></script><script src="js/data.js" type="text/javascript"></script><script src="../js/search.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/jquery.paligocode.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta name="generator" content="Paligo"></meta><link rel="prev" href="troubleshooting-performance-and-connectivity-using-ping--traceroute--or-telnet.html" title="Troubleshooting Performance and Connectivity using Ping, Traceroute, or Telnet"></link><link rel="next" href="netskope-private-access-for-microsoft-active-directory-domain-services.html#UUID-cb7ba306-ed55-b0de-5f86-4f52338ce85d_section-idm4605888535617632697519818376" title="Configure Private Apps for DNS with the Publisher DNS Feature Enabled"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script type="text/javascript">var containerid = 'GTM-W56WJ8S';

						(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
						new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
						j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
						'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
						})(window,document,'script','dataLayer',containerid);
					</script><script type="text/javascript">
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				if (!document.documentMode) {
				$('.materialboxed').materialbox();
				}});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc collapsible-sidebar-nav current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><h1 class="publication-title">Netskope Help</h1><div class="toolbar"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"></div><div class="tool-print print-icon"><a onclick="window.print();return false;"><i class="fa fa-print" aria-hidden="true"><span class="print-text">print</span></i></a></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"> <a href="index-en.html">Netskope Help</a></li><li class="breadcrumb-link"><a href="data-security.html">Data Security</a></li><li class="breadcrumb-link"><a href="netskope-private-access.html"><span class="phrase">Netskope Private Access</span></a></li><li class="breadcrumb-node"><span class="phrase">Netskope Private Access</span> for Microsoft Active Directory Domain Services</li></ul></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="troubleshooting-performance-and-connectivity-using-ping--traceroute--or-telnet.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="netskope-private-access-for-microsoft-active-directory-domain-services.html#UUID-cb7ba306-ed55-b0de-5f86-4f52338ce85d_section-idm4605888535617632697519818376">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-9fa806df-4b23-28df-0d31-e4172c3d4f7c" data-permalink="netskope-private-access-for-microsoft-active-directory-domain-services.html" data-topic-level="1" data-relative-prefix="" data-time-modified="December 24, 2021" data-publication-date="" id="UUID-cb7ba306-ed55-b0de-5f86-4f52338ce85d"><div class="titlepage"><div><div class="title"><h4 class="title"><span class="phrase">Netskope Private Access</span> for Microsoft Active Directory Domain Services</h4></div></div></div><p>This topic explains how to configure <span class="phrase">Netskope Private Access</span> (NPA) applications for Microsoft Active Directory Domain Services, such as DNS, Kerberos, and WINS.</p><p>Often customers are looking for the same end-user experience in using Windows Active Directory Domain Services for mobile workforce as for on-premises. For example, if users working remotely on a company-managed Active Directory Domain joined device would like to connect to an on-premises application which uses Windows integrated authentication, they should not be prompted for a password. </p><p><span class="phrase">Netskope Private Access</span> enables administrators to expand Domain Services experience to the remote users conveniently and securely. The following diagram shows an example:</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:540px;
                            "><tr><td style="padding:0;"><img src="image/uuid-b57f71a3-d64a-8cc9-3417-76fb87eea881.png" style="max-width: 540px; " alt="image1.png" title="image1.png"></img></td></tr></table></div><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-cb7ba306-ed55-b0de-5f86-4f52338ce85d_section-idm4605888535617632697519818376"><div class="titlepage"><div><div class="title"><h5 class="title">Configure Private Apps for DNS with the Publisher DNS Feature Enabled</h5></div></div></div><p>The first step to enable end-users using Active Directory Domain Services and file shares remotely is to configure native, <span class="emphasis"><em>pass-through</em></span> DNS resolution for the internal Active Directory Domain. In the default NPA deployment, each private application is represented to the client with an artificial non-routable IP address that’s been returned to the user in the DNS query response. </p><p>For example, if an on-premises private application has an IP address 10.0.0.10, NPA publisher will be accessing it using this IP address, while the end-users will receive an artificial IP address like 191.1.1.5 when running DNS query from their managed devices. To use Windows Domain Services, users have to use the real IP addresses of Windows Domain Controllers. To achieve that you need to configure a private application for DNS with the Publisher DNS feature enabled. This private DNS application allows users to join Active Directory Domains, query Active Directory groups policies, and FSMO roles from their remote devices.</p><p>To create a Private Application, log in to the Netskope UI, go to <span class="strong strong"><strong>Settings &gt; Security Cloud Platform &gt; App Definition &gt; Private Apps</strong></span>, and then create a new private application named <span class="emphasis"><em>Internal AD DNS</em></span> with these parameters:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Host: <code class="literal">*.yourwindowsdomain.com</code> and <code class="literal">.yourwindowsdomain.com</code></p></li><li class="listitem"><p>Protocol and Port: </p><p>TCP: <code class="literal">53</code></p><p>UDP: <code class="literal">53</code></p></li><li class="listitem"><p>Publisher: Select Publishers that can access your local internal DNS server resources.</p></li><li class="listitem"><p>Use Publisher DNS: Enable the toggle.</p></li></ul></div><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:315px;
                            "><tr><td style="padding:0;"><img src="image/uuid-d6c1da85-f52e-f340-3a89-1f08d8c133e4.png" style="max-width: 315px; " alt="image2.png" title="image2.png"></img></td></tr></table></div><p>In the above configuration:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Host remote device will be accessing domain controllers using domain SRV records <code class="literal">_gc._tcp. yourwindowsdomain.com</code> and <code class="literal">_ldap._tcp._sites.DomainDnsZones. yourwindowsdomain.com</code>, so we’re defining <code class="literal">yourwindowsdomain.com</code> and <code class="literal">*.yourwindowsdomain.com</code> wildcard as application FQDN to cover all DNS queries for Windows Domain Services.</p></li><li class="listitem"><p>Port: Port 53 should be used for the DNS traffic</p></li></ul></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-cb7ba306-ed55-b0de-5f86-4f52338ce85d_section-idm4598684868313632697519476238"><div class="titlepage"><div><div class="title"><h5 class="title">Configure Private Apps for Active Directory Domain Controllers</h5></div></div></div><p>Next, define a private application that enables users to access Windows Domain Controllers from their managed devices.</p><p>Because the previous application you configured will return to the end-user internal IP address of the domain controller, you need to configure a private application that encompasses IP addresses for all domain controllers so that they become accessible via NPA.</p><p>Domain controllers are represented in DNS as SRV records. To retrieve all Domain Controllers for your Domain, use the nslookup utility on any endpoint that is able to access your internal DNS servers/AD controllers. In the example below, we assume your AD DNS name is <code class="literal">yourwindowsdomain.com</code>.</p><pre class="programlisting">&gt; nslookup
Default Server: dns01.yourwindowsdomain.com
Address: 10.1.2.3
&gt; set type=SRV
&gt; _ldap._tcp.yourwindowsdomain.com</pre><p>If your network is very distributed, you may want to map different publishers to serve different Active Directory controllers to achieve even distribution of Active Directory traffic.</p><p>The following configuration is based on the diagram at the beginning of this document.</p><p>Create a new Private Application for Active Directory Domain Services named <span class="emphasis"><em>AD DCs Site 1</em></span> with these parameters:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Host: <code class="literal">10.0.1.10</code> and <code class="literal">10.0.1.20</code></p></li><li class="listitem"><p>Protocol and Port: </p><p>TCP: <code class="literal">88,135,137,139,389,445,464,636,1512,3268,3269,5357,49152-65535</code></p><p>UDP: <code class="literal">88,123,135,137,138,389,464,1512,5357</code></p></li><li class="listitem"><p>Publisher:  In this case, you will select <span class="emphasis"><em>pub1</em></span>. because it is best positioned to serve traffic to those domain controllers. If you have more than one publisher deployed at that physical location, you can also add them to the list of publishers serving this application for redundancy purposes. </p></li><li class="listitem"><p>Use Publisher DNS: Disable the toggle.</p></li></ul></div><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:315px;
                            "><tr><td style="padding:0;"><img src="image/uuid-e46ccb18-8092-66c7-3edc-7732171a69d4.png" style="max-width: 315px; " alt="image3.png" title="image3.png"></img></td></tr></table></div><p>Ports used in the above configuration are:</p><div class="table table-responsive" id="UUID-cb7ba306-ed55-b0de-5f86-4f52338ce85d_table-idm4660235705600032709049191439"><div class="table-title">Table 2. TCP</div><div class="table table-responsive-contents"><table class="table frame-box rules-all"><colgroup><col style="width:25%;"></col><col style="width:75%;"></col></colgroup><thead><tr><th class="th" data-priority="1"><p>Port</p></th><th class="th" data-priority="1"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p>88</p></td><td class="td"><p>Kerberos query</p></td></tr><tr><td class="td"><p>135</p></td><td class="td"><p>Remote Procedure Call</p></td></tr><tr><td class="td"><p>137</p></td><td class="td"><p>NetBIOS name</p></td></tr><tr><td class="td"><p>139</p></td><td class="td"><p>NetBIOS session</p></td></tr><tr><td class="td"><p>389</p></td><td class="td"><p>LDAP</p></td></tr><tr><td class="td"><p>445</p></td><td class="td"><p>SMB</p></td></tr><tr><td class="td"><p>464</p></td><td class="td"><p>Kerberos password change</p></td></tr><tr><td class="td"><p>636</p></td><td class="td"><p>Secure LDAP</p></td></tr><tr><td class="td"><p>1512</p></td><td class="td"><p>WINS</p></td></tr><tr><td class="td"><p>3268</p></td><td class="td"><p>LDAP for Global Catalog</p></td></tr><tr><td class="td"><p>3269</p></td><td class="td"><p>Secure LDAP to Global Catalog</p></td></tr><tr><td class="td"><p>5357</p></td><td class="td"><p>Network Discovery</p></td></tr><tr><td class="td"><p>49152-65535</p></td><td class="td"><p>Ephemeral ports required</p></td></tr></tbody></table></div></div><br class="table table-responsive-break"></br><div class="table table-responsive" id="UUID-cb7ba306-ed55-b0de-5f86-4f52338ce85d_table-idm4601473613313632709111060049"><div class="table-title">Table 3. UDP</div><div class="table table-responsive-contents"><table class="table frame-box rules-all"><colgroup><col style="width:25%;"></col><col style="width:75%;"></col></colgroup><thead><tr><th class="th" data-priority="1"><p>Port</p></th><th class="th" data-priority="1"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p>88</p></td><td class="td"><p>Kerberos query</p></td></tr><tr><td class="td"><p>123</p></td><td class="td"><p>NTP - used to set client time from domain controllers</p></td></tr><tr><td class="td"><p>135</p></td><td class="td"><p>Remote Procedure call</p></td></tr><tr><td class="td"><p>137</p></td><td class="td"><p>NetBIOS name</p></td></tr><tr><td class="td"><p>138</p></td><td class="td"><p>NetBIOS datagram</p></td></tr><tr><td class="td"><p>389</p></td><td class="td"><p>LDAP</p></td></tr><tr><td class="td"><p>464</p></td><td class="td"><p>Kerberos password change</p></td></tr><tr><td class="td"><p>512</p></td><td class="td"><p>WINS</p></td></tr><tr><td class="td"><p>5357</p></td><td class="td"><p>Network Discovery</p></td></tr></tbody></table></div></div><br class="table table-responsive-break"></br><p>Repeat the same steps to create another new private application named <span class="emphasis"><em>AD DCs Site 2</em></span> but using <code class="literal">10.0.2.10</code> and <code class="literal">10.0.2.20</code> as the IP addresses in the application definition, as shown below:</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:315px;
                            "><tr><td style="padding:0;"><img src="image/uuid-a3fd1383-ae24-1fa2-d073-7dc41746317f.png" style="max-width: 315px; " alt="image6.png" title="image6.png"></img></td></tr></table></div><p>After defining the above two applications, you can assign them to a user via <span class="phrase">Real-time Protection</span> policy. Those users should have full ability to log in to the domain, change their domain password, update Global Policy Objects (GPO), and more.</p></section></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-cb7ba306-ed55-b0de-5f86-4f52338ce85d">Netskope Private Access for Microsoft Active Directory Domain Services</a></li><li><a href="#UUID-cb7ba306-ed55-b0de-5f86-4f52338ce85d_section-idm4605888535617632697519818376">Configure Private Apps for DNS with the Publisher DNS Feature Enabled</a></li><li><a href="#UUID-cb7ba306-ed55-b0de-5f86-4f52338ce85d_section-idm4598684868313632697519476238">Configure Private Apps for Active Directory Domain Controllers</a></li></ul></aside><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article><div class="feedback-panel"><div id="email-feedback" class="no-voting toggle-feedback"><p><a href="mailto:techpubs@netskope.com?subject=Feedback%20for%20help%20topic%20%22Netskope%20Private%20Access%20for%20Microsoft%20Active%20Directory%20Domain%20Services%22&amp;body=%0A%09%09%09%09%0A%09%09%09%09%0A%09%09%09%09_______________________%0A%09%09%09%09%0A%09%09%09Please%20add%20your%20feedback%20above%20for%20topic%20%22Netskope%20Private%20Access%20for%20Microsoft%20Active%20Directory%20Domain%20Services%22%20in%20the%20publication%20%22Netskope%20Help%22."><i aria-hidden="true" class="fa fa-pencil-square-o feedbackicon"></i>Would you like to provide feedback? Just click here to suggest edits.</a></p></div></div></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="troubleshooting-performance-and-connectivity-using-ping--traceroute--or-telnet.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="netskope-private-access-for-microsoft-active-directory-domain-services.html#UUID-cb7ba306-ed55-b0de-5f86-4f52338ce85d_section-idm4605888535617632697519818376">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2021 Netskope </div><div class="date-modified"><span class="date-modified-text">Last modified: </span><span class="formatted-date">December 24, 2021</span></div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div><!--Google Tag Manager (noscript)--><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W56WJ8S" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!--End Google Tag Manager (noscript)--></body></html>
