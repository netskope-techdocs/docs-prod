<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="yes"></meta><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
					var anchoroption = true;
				
			
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Palo Alto Networks NGFW Configuration</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/roboto.font.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/rwd-table.min.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/layout-custom-style.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="js/toc.js" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/rwd-table.min.js" type="text/javascript"></script><script src="../js/responsive-tables.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="../js/lunr.js" type="text/javascript"></script><script src="../js/jquery.mark.min.js" type="text/javascript"></script><script src="js/data.js" type="text/javascript"></script><script src="../js/search.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta name="generator" content="Paligo"></meta><link rel="prev" href="netskope-gre-configuration.html" title="Netskope GRE Configuration"></link><link rel="next" href="palo-alto-networks-ngfw-configuration.html#idm46096599244576" title="Configure Tunnel Interfaces"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZT8KHXMB6T"></script><script type="text/javascript">var propertyid = 'G-ZT8KHXMB6T';

						window.dataLayer = window.dataLayer || [];
						function gtag(){dataLayer.push(arguments)};
						gtag('js', new Date());
						
						gtag('config', propertyid);
					</script><script type="text/javascript">
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				if (!document.documentMode) {
				$('.materialboxed').materialbox();
				}});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><h1 class="publication-title">Netskope Help</h1><div class="toolbar"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"></div><div class="tool-print print-icon"><a onclick="window.print();return false;"><i class="fa fa-print" aria-hidden="true"><span class="print-text">print</span></i></a></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"> <a href="index-en.html">Netskope Help</a></li><li class="breadcrumb-link"><a href="integrations.html">Integrations</a></li><li class="breadcrumb-link"><a href="ipsec-and-gre.html">IPSec and GRE</a></li><li class="breadcrumb-link"><a href="integrate-netskope-gre-with-palo-alto-networks-ngfw.html">Integrate Netskope GRE with Palo Alto Networks NGFW</a></li><li class="breadcrumb-node">Palo Alto Networks NGFW Configuration</li></ul></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="netskope-gre-configuration.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="palo-alto-networks-ngfw-configuration.html#idm46096599244576">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-f22f82a9-aea0-27d2-87b6-282bed94be61" data-permalink="palo-alto-networks-ngfw-configuration.html" data-topic-level="1" data-relative-prefix="" data-time-modified="January 28, 2021" data-publication-date="" id="UUID-b8f19ec9-c96e-33fa-862b-54bb23443c52"><div class="titlepage"><div><div class="title"><h5 class="title">Palo Alto Networks NGFW Configuration</h5></div></div></div><p>Before making any changes, create a backup and export the current running configuration on each NGFW. The configuration steps below are specific to the Example Configuration and will need to be modified to suit your environment.</p><p>The following tables detail the example configuration used for the Palo Alto NGFW in this guide.</p><p><span class="strong strong"><strong>Interfaces</strong></span></p><div class="informaltable table-responsive"><table class="informaltable frame-box rules-all"><colgroup><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col></colgroup><thead><tr><th class="th leftcol" data-priority="1"><p>Name</p></th><th class="th leftcol" data-priority="1"><p>Virtual Router</p></th><th class="th leftcol" data-priority="1"><p>Zone</p></th><th class="th leftcol" data-priority="1"><p>Network</p></th><th class="th leftcol" data-priority="1"><p>Interface IP</p></th></tr></thead><tbody><tr><td class="td leftcol"><p>ethernet 1/1</p></td><td class="td leftcol"><p>default</p></td><td class="td leftcol"><p>public</p></td><td class="td leftcol"><p>10.254.1.0/24</p></td><td class="td leftcol"><p>10.254.1.253</p></td></tr><tr><td class="td leftcol"><p>ethernet 1/2</p></td><td class="td leftcol"><p>default</p></td><td class="td leftcol"><p>private</p></td><td class="td leftcol"><p>10.254.2.0/24</p></td><td class="td leftcol"><p>10.254.2.253</p></td></tr><tr><td class="td leftcol"><p>tunnel.1</p></td><td class="td leftcol"><p>default</p></td><td class="td leftcol"><p>public</p></td><td class="td leftcol"><p>10.1.1.0/30</p></td><td class="td leftcol"><p>10.1.1.1</p></td></tr><tr><td class="td leftcol"><p>tunnel.2</p></td><td class="td leftcol"><p>default</p></td><td class="td leftcol"><p>public</p></td><td class="td leftcol"><p>10.1.2.0/30</p></td><td class="td leftcol"><p>10.1.2.1</p></td></tr></tbody></table></div><p><span class="strong strong"><strong>Routing</strong></span></p><div class="informaltable table-responsive"><table class="informaltable frame-box rules-all"><colgroup><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col></colgroup><thead><tr><th class="th leftcol" data-priority="1"><p>Virtual Router</p></th><th class="th leftcol" data-priority="1"><p>Interfaces</p></th><th class="th leftcol" data-priority="1"><p>Name</p></th><th class="th leftcol" data-priority="1"><p>Destination</p></th><th class="th leftcol" data-priority="1"><p>Next Hop</p></th></tr></thead><tbody><tr><td class="td leftcol"><p>default</p></td><td class="td leftcol"><p>ethernet 1/1</p><p>ethernet 1/2</p></td><td class="td leftcol"><p>default</p></td><td class="td leftcol"><p>0.0.0.0/0</p></td><td class="td leftcol"><p>10.254.1.1</p></td></tr><tr><td class="td leftcol"><p>default</p></td><td class="td leftcol"><p>ethernet 1/1</p><p>ethernet 1/2</p></td><td class="td leftcol"><p>private</p></td><td class="td leftcol"><p>10.254.0.0/16</p></td><td class="td leftcol"><p>10.254.2.1</p></td></tr></tbody></table></div><p><span class="strong strong"><strong>Rules</strong></span></p><div class="informaltable table-responsive"><table class="informaltable frame-box rules-all"><colgroup><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col></colgroup><thead><tr><th class="th leftcol" data-priority="1"><p>Name</p></th><th class="th leftcol" data-priority="1"><p>Source Zone</p></th><th class="th leftcol" data-priority="1"><p>Source Address</p></th><th class="th leftcol" data-priority="1"><p>Destination Zone</p></th><th class="th leftcol" data-priority="1"><p>Destination Address</p></th><th class="th leftcol" data-priority="1"><p>Application</p></th><th class="th leftcol" data-priority="1"><p>Service</p></th></tr></thead><tbody><tr><td class="td leftcol"><p>allow_icmp</p></td><td class="td leftcol"><p>private</p></td><td class="td leftcol"><p>10.254.0.0/16</p></td><td class="td leftcol"><p>public</p></td><td class="td leftcol"><p>any</p></td><td class="td leftcol"><p>icmp</p></td><td class="td leftcol"><p>application-default</p></td></tr><tr><td class="td leftcol"><p>allow_dns</p></td><td class="td leftcol"><p>private</p></td><td class="td leftcol"><p>10.254.0.0/16</p></td><td class="td leftcol"><p>public</p></td><td class="td leftcol"><p>any</p></td><td class="td leftcol"><p>dns</p></td><td class="td leftcol"><p>application-default</p></td></tr><tr><td class="td leftcol"><p>allow_ntp</p></td><td class="td leftcol"><p>private</p></td><td class="td leftcol"><p>10.254.0.0/16</p></td><td class="td leftcol"><p>public</p></td><td class="td leftcol"><p>any</p></td><td class="td leftcol"><p>ntp</p></td><td class="td leftcol"><p>application-default</p></td></tr><tr><td class="td leftcol"><p>allow_http_https</p></td><td class="td leftcol"><p>private</p></td><td class="td leftcol"><p>10.254.0.0/16</p></td><td class="td leftcol"><p>public</p></td><td class="td leftcol"><p>any</p></td><td class="td leftcol"><p>any</p></td><td class="td leftcol"><p>service-http</p><p>service-https</p></td></tr></tbody></table></div><p><span class="strong strong"><strong>NAT</strong></span></p><div class="informaltable table-responsive paligo-filter-table"><table class="informaltable frame-box rules-all"><colgroup><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col><col align="left"></col></colgroup><thead><tr><th class="th leftcol" data-priority="1"></th><th class="th leftcol" data-priority="1"><p>Original Packet</p></th><th class="th leftcol" data-priority="1"><p>Translated Packet</p></th><th class="th leftcol" data-priority="1"></th><th class="th leftcol" data-priority="1"></th><th class="th leftcol" data-priority="1"></th><th class="th leftcol" data-priority="1"></th><th class="th leftcol" data-priority="1"></th></tr></thead><tbody><tr><td class="td leftcol"><p>Name</p></td><td class="td leftcol"><p>Source Zone</p></td><td class="td leftcol"><p>Destination Zone</p></td><td class="td leftcol"><p>Destination Interface</p></td><td class="td leftcol"><p>Source Address</p></td><td class="td leftcol"><p>Destination Address</p></td><td class="td leftcol"><p>Service</p></td><td class="td leftcol"><p>Source Translation</p></td></tr><tr><td class="td leftcol"><p>snat_private</p></td><td class="td leftcol"><p>private</p></td><td class="td leftcol"><p>public</p></td><td class="td leftcol"><p>ethernet1/1</p></td><td class="td leftcol"><p>10.254.0.0/16</p></td><td class="td leftcol"><p>any</p></td><td class="td leftcol"><p>any</p></td><td class="td leftcol"><p>dynamic-ip</p><p>10.254.1.253</p></td></tr></tbody></table></div><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm46096599244576"><div class="titlepage"><div><div class="title"><h6 class="title">Configure Tunnel Interfaces</h6></div></div></div><p>To perform these steps, first log in to your Palo Alto Networks admin account. If you want to skip over the UI steps, CLI commands are provided at the end of this section to speed up the configuration tasks.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Go to <span class="bold bold"><strong>Network &gt; Interfaces &gt; Tunnels </strong></span>. Click <span class="bold bold"><strong>Add</strong></span> to configure the 1st tunnel interface.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-a8467b20-bc31-9092-2152-f15841fe27fe.png" style="max-width: 450px; " alt="image5.png"></img></td></tr></table></div></li><li class="listitem"><p>The read-only Interface Name is set to tunnel. In the adjacent field, enter a numeric suffix (1-9999) to identify the interface.</p></li><li class="listitem"><p>Assign a virtual router to the interface, or click <span class="strong strong"><strong>Virtual Router</strong></span> to define a new one.</p></li><li class="listitem"><p>Select a security zone for the interface, or click <span class="strong strong"><strong>Zone</strong></span> to define a new zone.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-4468038d-2f34-7b2e-7516-abf515a8ea67.png" style="max-width: 450px; " alt="image6.png"></img></td></tr></table></div></li><li class="listitem"><p>Select the <span class="strong strong"><strong>IPv4</strong></span> tab, and click <span class="strong strong"><strong>Add</strong></span>.</p></li><li class="listitem"><p>Assign a tunnel interface IP and subnet mask. This IP subnet is only locally significant to the tunnel.</p></li><li class="listitem"><p>Select <span class="strong strong"><strong>OK</strong></span> to save the tunnel interface.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-5a379836-92cf-01e7-ce51-276db40fd59d.png" style="max-width: 450px; " alt="image7.png"></img></td></tr></table></div></li><li class="listitem"><p>Repeat the above steps to configure a 2nd tunnel interface: Change the <span class="strong strong"><strong>tunnel suffix</strong></span> and the tunnel interface <span class="strong strong"><strong>IP</strong></span> and subnet mask.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-ced0cb1e-0150-0cda-d45f-841573803ab5.png" style="max-width: 450px; " alt="image8.png"></img></td></tr></table></div><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-5ed043a8-cc3a-339d-1ab4-fea6adf98065.png" style="max-width: 450px; " alt="image9.png"></img></td></tr></table></div></li></ol></div><p><span class="bold bold"><strong>CLI Commands</strong></span></p><p>Use these CLI commands to speed up the configuration.</p><pre class="programlisting"># set network interface tunnel units tunnel.1 ip 10.1.1.1/30
    # set network virtual-router default interface tunnel.1
    # set zone public network layer3 tunnel.1
    # set network interface tunnel units tunnel.2 ip 10.1.2.1/30
    # set network virtual-router <span class="strong strong"><strong>default</strong></span> interface <span class="strong strong"><strong>tunnel.2</strong></span>
   # set zone <span class="strong strong"><strong>public</strong></span> network layer3 <span class="strong strong"><strong>tunnel.2</strong></span></pre></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm46096599244384"><div class="titlepage"><div><div class="title"><h6 class="title">Configure the GRE Tunnels</h6></div></div></div><p>If you want to skip over the UI steps, CLI commands are provided at the end of this section to speed up the configuration tasks.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Go to <span class="bold bold"><strong>Network &gt; GRE Tunnels</strong></span>. Click <span class="bold bold"><strong>Add</strong></span> to configure the 1st GRE tunnel</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-3981b07a-dfcb-3a30-0fe2-b296ec476b81.png" style="max-width: 450px; " alt="image10.png"></img></td></tr></table></div></li><li class="listitem"><p>Use <span class="strong strong"><strong>GRE Gateway IP</strong></span> from 1st Netskope POP selected in step 1.5 as the <span class="strong strong"><strong>Peer Address</strong></span>. In this example MEL1 will be used for the 1st tunnel (<span class="strong strong"><strong>tunnel.1</strong></span>).</p></li><li class="listitem"><p>Enable <span class="strong strong"><strong>Keep Alive</strong></span> so the GRE tunnel stays connected when/if the User traffic is idle.</p></li><li class="listitem"><p>Select <span class="strong strong"><strong>OK</strong></span> to save.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-86ee42e0-6cbf-6314-6734-a3e6e8497af5.png" style="max-width: 450px; " alt="image11.png"></img></td></tr></table></div></li><li class="listitem"><p>Configure the 2nd GRE tunnel.</p></li><li class="listitem"><p>Repeat the above steps using the GRE Gateway IP from the 2nd Netskope POP selected as the Peer Address. In this example SY4 will be used for the 2nd tunnel (<span class="strong strong"><strong>tunnel.2</strong></span>).</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-25b1402e-2973-1ab9-0c89-67aff04763a8.png" style="max-width: 450px; " alt="image12.png"></img></td></tr></table></div></li><li class="listitem"><p>Commit the configuration.</p></li><li class="listitem"><p>The GRE tunnels should establish and can be verified using the CLI. Please refer to <a class="xref" href="verify-gre-tunnels-are-established.html" title="Verify GRE Tunnels are Established"><span class="xreftitle">Verify GRE Tunnels are Established</span></a>.</p></li></ol></div><p><span class="bold bold"><strong>CLI Commands</strong></span></p><p>Use these CLI commands to speed up the configuration.</p><pre class="programlisting"># set network tunnel gre <span class="strong strong"><strong>netskope_mel1</strong></span> tunnel-interface <span class="strong strong"><strong>tunnel.1</strong></span> peer-address ip <span class="strong strong"><strong>163.116.198.36</strong></span>
# set network tunnel gre <span class="strong strong"><strong>netskope_mel1</strong></span> tunnel-interface <span class="strong strong"><strong>tunnel.1</strong></span> local-address interface <span class="strong strong"><strong>ethernet1/1</strong></span> ip <span class="strong strong"><strong>10.254.1.253/24</strong></span>
# set network tunnel gre <span class="strong strong"><strong>netskope_mel1</strong></span> tunnel-interface <span class="strong strong"><strong>tunnel.1</strong></span> keep-alive enable yes
# set network tunnel gre <span class="strong strong"><strong>netskope_sy4</strong></span> tunnel-interface <span class="strong strong"><strong>tunnel.2</strong></span> peer-address ip <span class="strong strong"><strong>45.250.160.32</strong></span>
# set network tunnel gre <span class="strong strong"><strong>netskope_sy4</strong></span> tunnel-interface <span class="strong strong"><strong>tunnel.2</strong></span> local-address interface <span class="strong strong"><strong>ethernet1/1</strong></span> ip <span class="strong strong"><strong>10.254.1.253/24</strong></span>
# set network tunnel gre <span class="strong strong"><strong>netskope_sy4</strong></span> tunnel-interface <span class="strong strong"><strong>tunnel.2</strong></span> keep-alive enable yes
# commit</pre></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-b8f19ec9-c96e-33fa-862b-54bb23443c52_section-idm232236102329852"><div class="titlepage"><div><div class="title"><h6 class="title">Policy Based Forwarding (PBF)</h6></div></div></div><p>PBF will steer the relevant traffic to the Netskope POP over the GRE tunnel. It’s recommended to forward Web Traffic (TCP 80/443 etc.) only. When creating PBF rules, it is recommended to be as specific as possible to ensure the correct traffic is sent to Netskope Cloud. If you want to skip over the UI steps, CLI commands are provided at the end of this section to speed up the configuration tasks.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Go to <span class="bold bold"><strong>Objects &gt; Services &gt; Add</strong></span>.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-1d6149df-0131-cebe-91a7-c2f70128bdf2.png" style="max-width: 450px; " alt="image13.png"></img></td></tr></table></div></li><li class="listitem"><p>Configure a custom service for Netskope traffic. This provides the flexibility to easily add additional custom ports at a later date.</p></li><li class="listitem"><p>Your <span class="strong strong"><strong>TCP 80 and 443</strong></span> traffic should be steered to Netskope by default.</p></li><li class="listitem"><p>Select <span class="strong strong"><strong>OK</strong></span> to save.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-7a3b089e-2be4-acb2-5682-c9269dab1fc5.png" style="max-width: 450px; " alt="image14.png"></img></td></tr></table></div></li><li class="listitem"><p>Go to <span class="bold bold"><strong>Network &gt; Network Profiles &gt; Monitor &gt; Add</strong></span>.</p></li><li class="listitem"><p>This monitor will be used to check the GRE tunnel connectivity is established using ICMP. If the monitor fails, the tunnel should failover to the 2nd GRE tunnel.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-487e3647-48fe-668f-4294-cbbd7483b530.png" style="max-width: 450px; " alt="image15.png"></img></td></tr></table></div></li><li class="listitem"><p>Give the monitor a Name and change the Action to <span class="strong strong"><strong>Fail Over</strong></span>. Adjust the <span class="strong strong"><strong>Interval</strong></span> and <span class="strong strong"><strong>Threshold</strong></span> to your liking.</p></li><li class="listitem"><p>Select <span class="strong strong"><strong>OK</strong></span> to save.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:315px;
                            "><tr><td style="padding:0;"><img src="image/uuid-19d9e66a-43fb-92fa-e42f-31335bc21e7d.png" style="max-width: 315px; " alt="image16.png"></img></td></tr></table></div></li><li class="listitem"><p>Go to <span class="bold bold"><strong>Policies &gt; Policy Based Forwarding &gt; Add</strong></span>.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-875b97e7-7e91-3f37-2276-d6474d4368cd.png" style="max-width: 450px; " alt="image17.png"></img></td></tr></table></div></li><li class="listitem"><p>Configure the PBF Rule to steer traffic over the 1st GRE tunnel (<span class="strong strong"><strong>tunnel.1</strong></span> interface), which corresponds to MEL1 POP.</p></li><li class="listitem"><p>Give the PBF Rule a <span class="strong strong"><strong>Name</strong></span></p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-29b4e366-7449-6173-fb45-dd8b1d008ee3.png" style="max-width: 450px; " alt="image18.png"></img></td></tr></table></div></li><li class="listitem"><p>Select the <span class="strong strong"><strong>Source</strong></span> tab and enter the criteria specific to your environment.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-29c339f1-9e55-a7e9-810c-f36d497faef2.png" style="max-width: 450px; " alt="image19.png"></img></td></tr></table></div></li><li class="listitem"><p>Select the <span class="strong strong"><strong>Destination/Application/Service</strong></span> tab.</p></li><li class="listitem"><p>Add the SERVICE <span class="strong strong"><strong>service-netskope</strong></span> that was configured in step 1 of this section.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-1be3f81c-620c-0866-a0c1-836508b79beb.png" style="max-width: 450px; " alt="image20.png"></img></td></tr></table></div></li><li class="listitem"><p>Select the <span class="strong strong"><strong>Forwarding</strong></span> tab</p></li><li class="listitem"><p>Set the Action to <span class="strong strong"><strong>Forward</strong></span></p></li><li class="listitem"><p>Select <span class="strong strong"><strong>tunnel.1</strong></span> as the Egress Interface</p></li><li class="listitem"><p>Enable the <span class="strong strong"><strong>Monitor</strong></span> and select the <span class="strong strong"><strong>netskope_gre</strong></span> Profile created in step 5 of this section.</p></li><li class="listitem"><p>The IP Address is the Probe IP Address of the 1st Netskope POP selected. In this example <span class="bold bold"><strong>MEL1</strong></span>, will be used for the 1st tunnel.</p></li><li class="listitem"><p>Select <span class="strong strong"><strong>OK</strong></span> to save.</p></li><li class="listitem"><p>Configure the PBF Rule to steer traffic over the 2nd GRE tunnel (<span class="strong strong"><strong>tunnel.2</strong></span> interface), which corresponds to SY4 POP.</p></li><li class="listitem"><p>Repeat the above steps: Change the Name, Egress Interface to <span class="strong strong"><strong>tunnel.2</strong></span> and the Monitor IP Address.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-b5bb6943-7b17-37a1-3ce5-cc95647f0fa3.png" style="max-width: 450px; " alt="image22.png"></img></td></tr></table></div><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-29c339f1-9e55-a7e9-810c-f36d497faef2.png" style="max-width: 450px; " alt="image19.png"></img></td></tr></table></div><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-1be3f81c-620c-0866-a0c1-836508b79beb.png" style="max-width: 450px; " alt="image20.png"></img></td></tr></table></div><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-4e601ed6-af6c-79e8-150b-f22518dead4f.png" style="max-width: 450px; " alt="image23.png"></img></td></tr></table></div></li></ol></div><p><span class="bold bold"><strong>CLI Commands</strong></span></p><p>Use these CLI commands to speed up the configuration.</p><pre class="programlisting"># set service service-netskope protocol tcp port 80,443
# set network profiles monitor-profile netskope_gre interval <span class="strong strong"><strong>3</strong></span> threshold <span class="strong strong"><strong>5</strong></span> action fail-over
# set rulebase pbf rules <span class="strong strong"><strong>pbf_to_netskope_mel1</strong></span> action forward egress-interface <span class="strong strong"><strong>tunnel.1</strong></span> monitor ip-address <span class="strong strong"><strong>10.198.6.209</strong></span> profile netskope_gre
# set rulebase pbf rules <span class="strong strong"><strong>pbf_to_netskope_mel1</strong></span> source <span class="strong strong"><strong>10.254.2.0/24</strong></span> destination any service service-netskope from zone <span class="strong strong"><strong>private</strong></span>
# set rulebase pbf rules <span class="strong strong"><strong>pbf_to_netskope_sy4</strong></span> action forward egress-interface <span class="strong strong"><strong>tunnel.2</strong></span> monitor ip-address <span class="strong strong"><strong>172.24.16.13</strong></span> profile netskope_gre
# set rulebase pbf rules <span class="strong strong"><strong>pbf_to_netskope_sy4</strong></span> source <span class="strong strong"><strong>10.254.2.0/24</strong></span> destination any service service-netskope from zone <span class="strong strong"><strong>private</strong></span></pre></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-b8f19ec9-c96e-33fa-862b-54bb23443c52_section-idm232236128456362"><div class="titlepage"><div><div class="title"><h6 class="title">NAT Settings</h6></div></div></div><p>Once a packet matches the criteria of a single NAT rule, the packet is not subjected to additional NAT rules. Therefore, your list of NAT rules should be in order from most specific to least specific so that packets are subjected to the most specific rule you created for them.</p><p>When steering traffic to a Netskope POP via GRE, Secure NAT (SNAT) needs to be disabled. This allows the Netskope Cloud XD the “engine” of Netskope’s platform to see the real Source IP of the traffic for Policy and Logging purposes. In this example more specific SNAT rules need to be created to disable SNAT.</p><p>The SNAT/NAT configuration in this example prior to adding the specific SNAT rules for Netskope GRE is detailed below for reference. The current SNAT configuration will SNAT all traffic going from private to public zone with a source address of 10.254.0.0/16 to 10.254.1.253 (ethernet1/1 interface IP).</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:540px;
                            "><tr><td style="padding:0;"><img src="image/uuid-f8cf2017-715f-e785-6f73-3775c0d190d8.png" style="max-width: 540px; " alt="image24.png"></img></td></tr></table></div><div class="orderedlist"><p>If you want to skip over the UI steps, CLI commands are provided at the end of this section to speed up the configuration tasks.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Go to <span class="bold bold"><strong>Polices &gt; NAT</strong></span> and click <span class="bold bold"><strong>Add</strong></span>.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-5a45ea99-a617-777b-48fc-772e2c89191e.png" style="max-width: 450px; " alt="image25.png"></img></td></tr></table></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Configure the NAT Policy Rule to disable SNAT for traffic steered to 1st GRE tunnel (<span class="strong strong"><strong>tunnel.1</strong></span> interface).</p></li><li class="listitem"><p>Give the NAT Policy Rule a <span class="strong strong"><strong>Name</strong></span></p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-58c98da8-ff6e-5ce7-d503-e5842020c716.png" style="max-width: 450px; " alt="image26.png"></img></td></tr></table></div></li><li class="listitem"><p>Select the <span class="strong strong"><strong>Original Packet</strong></span> tab.</p></li><li class="listitem"><p>Configure the Source Zone, Destination Zone, Source Address to be as specific as possible. In this example, only be concerned with Source Addresses in the <span class="strong strong"><strong>10.254.2.0/24</strong></span> network.</p></li><li class="listitem"><p>Set the Destination Interface to <span class="strong strong"><strong>tunnel.1</strong></span>.</p></li><li class="listitem"><p>Set the Service to <span class="strong strong"><strong>service-netskope</strong></span>.</p></li><li class="listitem"><p>Select <span class="strong strong"><strong>OK</strong></span> to save.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-788b5c30-7133-0334-4279-4cecd182dffa.png" style="max-width: 450px; " alt="image27.png"></img></td></tr></table></div></li><li class="listitem"><p>Select the <span class="bold bold"><strong>Translated Packet</strong></span> tab.</p></li><li class="listitem"><p>Leave the defaults to <span class="strong strong"><strong>None</strong></span>.</p></li><li class="listitem"><p>Select <span class="strong strong"><strong>OK</strong></span> to Save.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-76afa255-242e-eef0-90d9-d6ca07f45e98.png" style="max-width: 450px; " alt="image28.png"></img></td></tr></table></div></li><li class="listitem"><p>Configure the NAT Policy Rule to disable SNAT for traffic steered to 2nd GRE tunnel (<span class="strong strong"><strong>tunnel.2</strong></span> interface).</p></li><li class="listitem"><p>Repeat the above steps: Change the Name and change the Destination Interface to <span class="strong strong"><strong>tunnel.2</strong></span></p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-de33c52f-28e8-4a73-42f2-aa33ff96917e.png" style="max-width: 450px; " alt="image29.png"></img></td></tr></table></div><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-de43a05f-868f-e8a1-1d68-b981a53ad7a8.png" style="max-width: 450px; " alt="image30.png"></img></td></tr></table></div><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-76afa255-242e-eef0-90d9-d6ca07f45e98.png" style="max-width: 450px; " alt="image28.png"></img></td></tr></table></div></li><li class="listitem"><p>Re-Order the NAT Policy Rules.</p></li><li class="listitem"><p>Depending on your environment, the SNAT/NAT rules will need to be re-ordered so the most specific rules are at the top. In this example I have placed the NAT Policy Rule to disable SNAT at the top.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:540px;
                            "><tr><td style="padding:0;"><img src="image/uuid-e5810d32-3bea-a898-5a49-e343e458e984.png" style="max-width: 540px; " alt="image31.png"></img></td></tr></table></div></li><li class="listitem"><p>Commit the final configuration and test.</p></li></ol></div><p><span class="bold bold"><strong>CLI Commands</strong></span></p><p>Use these CLI commands to speed up the configuration.</p><pre class="programlisting"># set rulebase nat rules <span class="strong strong"><strong>dont_snat_netskope_mel1</strong></span> from <span class="strong strong"><strong>private</strong></span> to <span class="strong strong"><strong>public</strong></span> source <span class="strong strong"><strong>10.254.2.0/24</strong></span> destination any service service-netskope to-interface <span class="strong strong"><strong>tunnel.1</strong></span>
# set rulebase nat rules <span class="strong strong"><strong>dont_snat_netskope_sy4</strong></span> from <span class="strong strong"><strong>private</strong></span> to <span class="strong strong"><strong>public</strong></span> source <span class="strong strong"><strong>10.254.2.0/24</strong></span> destination any service service-netskope to-interface <span class="strong strong"><strong>tunnel.2</strong></span>
# move rulebase nat rules dont_snat_netskope_mel1 top
# move rulebase nat rules dont_snat_netskope_sy4 after dont_snat_netskope_mel1
# commit</pre></section></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-b8f19ec9-c96e-33fa-862b-54bb23443c52">Palo Alto Networks NGFW Configuration</a></li><li><a href="#idm46096599244576">Configure Tunnel Interfaces</a></li><li><a href="#idm46096599244384">Configure the GRE Tunnels</a></li><li><a href="#UUID-b8f19ec9-c96e-33fa-862b-54bb23443c52_section-idm232236102329852">Policy Based Forwarding (PBF)</a></li><li><a href="#UUID-b8f19ec9-c96e-33fa-862b-54bb23443c52_section-idm232236128456362">NAT Settings</a></li></ul></aside><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article><div class="feedback-panel"><div id="email-feedback" class="no-voting toggle-feedback"><p><a href="mailto:techpubs@netskope.com?subject=Feedback%20for%20help%20topic%20%22Palo%20Alto%20Networks%20NGFW%20Configuration%22&amp;body=%0A%09%09%09%09%0A%09%09%09%09%0A%09%09%09%09_______________________%0A%09%09%09%09%0A%09%09%09Please%20add%20your%20feedback%20above%20for%20topic%20%22Palo%20Alto%20Networks%20NGFW%20Configuration%22%20in%20the%20publication%20%22Netskope%20Help%22."><i aria-hidden="true" class="fa fa-pencil-square-o feedbackicon"></i>Would you like to provide feedback? Just click here to suggest edits.</a></p></div></div></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="netskope-gre-configuration.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="palo-alto-networks-ngfw-configuration.html#idm46096599244576">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2021 Netskope </div><div class="date-modified"><span class="date-modified-text">Last modified: </span><span class="formatted-date">January 28, 2021</span></div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div></body></html>
